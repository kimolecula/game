"use strict";var kimolecula=angular.module("kimolecula",["ngResource","ngRoute","ngSanitize","ngL20n","hSweetAlert"]).run(["$rootScope",function($rootScope){$rootScope.server=function(url){return SERVER_URL+url},$rootScope.appName="Kimolécula",$rootScope.game={user:""}}]).config(["$routeProvider","$httpProvider","l20nProvider",function($routeProvider,$httpProvider,l20nProvider){$routeProvider.when("/home",{templateUrl:"templates/home.html",controller:"homeController"}).when("/fim-do-jogo",{templateUrl:"templates/fim-do-jogo.html",controller:"fimDoJogoController"}).when("/insira-seu-nome",{templateUrl:"templates/insira-seu-nome.html",controller:"insiraSeuNomeController"}).when("/instrucoes",{templateUrl:"templates/instrucoes.html",controller:"instrucoesController"}).when("/jogo",{templateUrl:"templates/jogo.html",controller:"jogoController"}).when("/sobre",{templateUrl:"templates/sobre.html",controller:"sobreController"}).when("/tentativas-excedidas",{templateUrl:"templates/tentativas-excedidas.html",controller:"tentativasExcedidasController"}).when("/um-pouco-de-quimica",{templateUrl:"templates/um-pouco-de-quimica.html",controller:"umPoucoDeQuimicaController"}).otherwise({redirectTo:"/home"})}]);kimolecula.controller("fimDoJogoController",function($http,$rootScope,$scope,$routeParams){$scope.finalPanda={image:"panda-final-12.png",text:""},$scope.init=function(){if($rootScope.game.user)if($rootScope.levelScore.bamboo<=10){var bambu=1==$rootScope.levelScore.bamboo?"bambu":"bambus";$scope.finalPanda.image="panda-final-12.png",$scope.finalPanda.text="Seu resultado foi insatisfatório e você conseguiu só "+$rootScope.levelScore.bamboo+" "+bambu+"... Assim o Professor Panda fica com fome! Vamos estudar mais?"}else $rootScope.levelScore.bamboo>10&&$rootScope.levelScore.bamboo<=18?($scope.finalPanda.image="panda-final-11.png",$scope.finalPanda.text="Você conseguiu "+$rootScope.levelScore.bamboo+" bambus, mas ainda assim o Professor Panda está faminto! Vamos alimentar o Professor de novo? Assim a gente estuda mais um pouco."):$rootScope.levelScore.bamboo>18&&$rootScope.levelScore.bamboo<=28?($scope.finalPanda.image="panda-final-13.png",$scope.finalPanda.text="Nossa! "+$rootScope.levelScore.bamboo+" bambus! Esse número é ótimo e o Professor está bem feliz! Que tal tentar de novo e deixar o Professor Panda totalmente satisfeito?"):$rootScope.levelScore.bamboo>28&&($scope.finalPanda.image="panda-final-10.png",$scope.finalPanda.text="Espetacular! Talvez o Professor Panda nunca tenha visto tanta inteligência junta! Você conseguiu "+$rootScope.levelScore.bamboo+" bambus! Agora sim o Professor está totalmente satisfeito e muito feliz com você! Que tal chamar seus amigos para jogar também?");else window.location="#/insira-seu-nome"},$scope.init()}),kimolecula.controller("homeController",function($http,$rootScope,$scope,$routeParams){$scope.init=function(){$rootScope.game={user:""}},$scope.init()}),kimolecula.controller("insiraSeuNomeController",function($http,$rootScope,$scope,$routeParams,sweet){$scope.init=function(){$scope.game={user:""}},$scope.validateUser=function(){$scope.game.user.length>=3?($rootScope.game={user:$scope.game.user},window.location="#/instrucoes"):sweet.show("Quem é você?","Preciso saber o seu nome para podermos jogar melhor...","error")},$scope.init()}),kimolecula.controller("instrucoesController",function($http,$rootScope,$scope,$routeParams){$scope.init=function(){},$scope.init()}),kimolecula.controller("jogoController",function($http,$rootScope,$scope,$routeParams,sweet,KimoleculaModel){function shuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}$scope.init=function(){$scope.game={user:"",bambooCounter:6,tipCounter:"1",levelData:"",levelNow:1,actualMolecule:"0",attemptsAnswer:"1",maxAttemptsAnswer:"6",answerChoice:[],lastTip:""},$rootScope.game.user?$scope.game.user=$rootScope.game.user:window.location="#/insira-seu-nome",$scope.getLevel($scope.game.levelNow)},$scope.getLevel=function(levelNow){KimoleculaModel.getLevel(levelNow).then(function(data){var newData=shuffle(data.level);if($scope.game.lastTip==newData[$scope.game.actualMolecule].tips[0])return $scope.game.lastTip=newData[$scope.game.actualMolecule].tips[0],void $scope.getLevel($scope.game.levelNow);for(var allAnswers=newData[$scope.game.actualMolecule].rightAnswer.concat(newData[$scope.game.actualMolecule].wrongAnswer),regex=/[0-9]\S/g,i=0;i<allAnswers.length;i++){var regexStr=allAnswers[i],regexMatch=regexStr.match(regex),regexReplace=regexStr.replace(regex,"<b>"+regexMatch+"</b>");allAnswers[i]=regexReplace}$scope.game.levelData={images:shuffle(newData[$scope.game.actualMolecule].imgFile),rightAnswer:newData[$scope.game.actualMolecule].rightAnswer,allAnswers:shuffle(allAnswers),tips:newData[$scope.game.actualMolecule].tips},$scope.game.levelData||sweet.show({title:"Ooops...",text:"Algum erro aconteceu no processamento da fase que você está... Tente novamente, por favor!",imageUrl:"design/panda-triste-04.png",showCancelButton:!1,confirmButtonText:"Começar de novo!",closeOnConfirm:!0},function(isConfirm){window.location="#/instrucoes"})},function(err){sweet.show({title:"Ooops...",text:"Não consegui encontrar a fase que você está jogando... Tente novamente, por favor!",imageUrl:"design/panda-triste-04.png",showCancelButton:!1,confirmButtonText:"Começar de novo!",closeOnConfirm:!0},function(isConfirm){window.location="#/instrucoes"})})},$scope.loseGame=function(type){1==type?sweet.show({title:"Você não tem mais bambus",text:"Infelizmente todos os bambus acabaram e agora o professor Panda ficará faminto! Comece de novo e ajude o professor a ficar com a barriga cheia!",imageUrl:"design/panda-triste-04.png",showCancelButton:!1,confirmButtonText:"Começar de novo!",closeOnConfirm:!0},function(isConfirm){window.location="#/instrucoes"}):2==type&&sweet.show({title:"Suas chances acabaram...",text:"Você utilizou todas as suas chances em tentar responder qual é a molécula apresentada... Assim o professor Panda ficará morrendo de fome! Comece novamente e alimente o professor com os bambus respondendo corretamente as questões...",imageUrl:"design/panda-triste-04.png",showCancelButton:!1,confirmButtonText:"Começar de novo!",closeOnConfirm:!0},function(isConfirm){window.location="#/instrucoes"})},$scope.getBamboo=function(num){return num<0?void $scope.loseGame(1):new Array(num)},$scope.letAnswer=function(molecule){for(var i=0;i<$scope.game.levelData.rightAnswer.length;i++)if(""==$scope.game.answerChoice[i]||!$scope.game.answerChoice[i]){if($scope.game.answerChoice[i]=molecule,i==$scope.game.levelData.rightAnswer.length-1)return void $scope.checkAnswer();return}},$scope.checkAnswer=function(){for(var regex=/<[^>]*>/g,answerChoice=$scope.game.answerChoice,i=0;i<answerChoice.length;i++){var regexStr=answerChoice[i],regexReplace=regexStr.replace(regex,"");answerChoice[i]=regexReplace}if(JSON.stringify(answerChoice)===JSON.stringify($scope.game.levelData.rightAnswer))$scope.game.levelNow+1>10?($rootScope.levelScore={bamboo:$scope.game.bambooCounter},window.location="#/fim-do-jogo"):sweet.show({title:"Resposta certa!",text:"Você acertou! Vamos para a próxima fase!",imageUrl:"design/panda-feliz-08.png",showCancelButton:!1,confirmButtonText:"Continuar!",closeOnConfirm:!0},function(isConfirm){$scope.game.bambooCounter+=3,$scope.game.tipCounter=1,$scope.game.answerChoice=[],$scope.game.levelNow++,$scope.game.attemptsAnswer=1,$scope.getLevel($scope.game.levelNow)});else{if($scope.game.attemptsAnswer+1>$scope.game.maxAttemptsAnswer)return void $scope.loseGame(2);sweet.show({title:"Quaaaase!",text:"A resposta que você colocou está incorreta!",imageUrl:"design/panda-triste-04.png",showCancelButton:!1,confirmButtonText:"Tentar novamente",closeOnConfirm:!0},function(isConfirm){$scope.game.attemptsAnswer++,$scope.game.answerChoice=[],$scope.$apply()})}},$scope.instructions=function(){var gameBody=document.getElementById("game-body");"flex"==window.getComputedStyle(gameBody.querySelector(".game-quiz"),null).getPropertyValue("display")?(gameBody.querySelector(".game-quiz").style.display="none",gameBody.querySelector(".game-help").style.display="block"):(gameBody.querySelector(".game-quiz").style.display="flex",gameBody.querySelector(".game-help").style.display="none")},$scope.quitGame=function(){sweet.show({title:"Tem certeza que deseja abandonar?",text:"Se você abandonar o game agora todos os seus bambus serão perdidos e o professor Panda ficará faminto!",imageUrl:"design/panda-triste-04.png",showCancelButton:!0,confirmButtonText:"Quero continuar!",cancelButtonText:"Sim, vou abandonar...",confirmButtonColor:"#388E3C",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm||($scope.game.bambooCounter=0,$scope.getBamboo($scope.game.bambooCounter),$scope.$apply(),window.location="#/home")})},$scope.changeMolecule=function(){0==$scope.game.bambooCounter?sweet.show({title:"Você não pode mais pular",text:"Todos os bambus já foram usados e o professor Panda está faminto! Responda a fórmula molecular para ganhar bambus ou comece novamente.",imageUrl:"design/panda-triste-04.png",showCancelButton:!0,confirmButtonText:"Vou responder!",cancelButtonText:"Vou abandonar...",confirmButtonColor:"#388E3C",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm||($scope.game.bambooCounter=0,$scope.$apply(),window.location="#/home")}):sweet.show({title:"Tem certeza que deseja pular?",text:"Se você escolher que sim, 1 bambu será usado para encontrar outro composto. Quanto menos bambus você tiver, mais fome o professor Panda ficará!",imageUrl:"design/panda-triste-04.png",showCancelButton:!0,confirmButtonText:"Não quero pular!",cancelButtonText:"Sim, quero pular...",confirmButtonColor:"#388E3C",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm||($scope.getLevel($scope.game.levelNow),$scope.game.attemptsAnswer=1,--$scope.game.bambooCounter,$scope.getBamboo($scope.game.bambooCounter),$scope.$apply())})},$scope.clainTip=function(){var pluralBamboo=$scope.game.tipCounter;pluralBamboo=pluralBamboo>1?"bambus serão usados":"bambu será usado",$scope.game.tipCounter<=3?$scope.game.bambooCounter>=$scope.game.tipCounter?sweet.show({title:"Tá precisando de uma dica?",text:"Se você escolher que sim, "+$scope.game.tipCounter+" "+pluralBamboo+" para comprar a dica. Quanto menos bambus você tiver, mais fome o professor Panda ficará!",imageUrl:"design/panda-bamboo-03.png",showCancelButton:!0,confirmButtonColor:"#388E3C",confirmButtonText:"Sim, quero a dica!",cancelButtonText:"Não, obrigado.",closeOnConfirm:!1,closeOnCancel:!0},function(isConfirm){isConfirm&&(sweet.show("Dica rápida",$scope.game.levelData.tips[$scope.game.tipCounter-1],"success"),$scope.game.bambooCounter=$scope.game.bambooCounter-$scope.game.tipCounter,$scope.getBamboo($scope.game.bambooCounter),$scope.game.tipCounter++,$scope.$apply())}):sweet.show({title:"Você não tem bambus suficientes",text:"A quantidade de bambu que você tem não é suficiente para comprar dicas agora, o professor Panda está ficando faminto! Para continuar, responda a questão para voltar a ganhar bambus ou comece novamente.",imageUrl:"design/panda-triste-04.png"}):sweet.show({title:"Você não tem mais dicas",text:"Infelizmente todas as suas dicas acabaram, se concentre, não é difícil!",imageUrl:"design/panda-triste-04.png"})},$scope.init()}),kimolecula.controller("sobreController",function($http,$rootScope,$scope,$routeParams){$scope.init=function(){},$scope.init()}),kimolecula.controller("tentativasExcedidasController",function($http,$rootScope,$scope,$routeParams){$scope.init=function(){},$scope.init()}),kimolecula.controller("umPoucoDeQuimicaController",function($http,$rootScope,$scope,$routeParams){$scope.init=function(){},$scope.init()}),function(){angular.module("ngL20n",[]).provider("l20n",function(){var previousLocale,locale,l20nProvider=this;l20nProvider.localeStorageKey="ngL20nLocale",l20nProvider.$get=function($rootScope,$timeout,documentL10n){function changeLocale(newLocale){function setRootScopeLocale(){$timeout(function(){documentL10n.removeEventListener("ready",setRootScopeLocale),$rootScope[l20nProvider.localeProperty]=locale})}previousLocale=locale,locale=newLocale,locale!==previousLocale&&(localStorage.setItem(l20nProvider.localeStorageKey,locale),l20nProvider.localeProperty&&documentL10n.addEventListener("ready",setRootScopeLocale),documentL10n.requestLocales(locale))}function updateData(){var event;documentL10n.updateData.apply(documentL10n,arguments),event=document.createEvent("HTMLEvents"),event.initEvent("l20n:dataupdated",!0,!0),document.dispatchEvent(event)}var l20nService=new function(){this.updateData=updateData,this.changeLocale=changeLocale};return documentL10n.once(function(){$rootScope.$apply(function(){l20nService.changeLocale(localStorage.getItem(l20nProvider.localeStorageKey)||documentL10n.supportedLocales[0])})}),l20nService},l20nProvider.$get.$inject=["$rootScope","$timeout","documentL10n"]}).directive("l20n",["documentL10n",function(documentL10n){return{restrict:"A",link:function(__scope,element,attrs){function localizeCurrentNode(){element[0].nodeType!==Node.COMMENT_NODE&&documentL10n.localizeNode(element[0])}attrs.$observe("l20n",function(l20n){return document.removeEventListener("l20n:dataupdated",localizeCurrentNode),l20n?(element.attr("data-l10n-id",l20n),void documentL10n.once(function(){document.addEventListener("l20n:dataupdated",localizeCurrentNode),localizeCurrentNode()})):void element.removeAttr("data-l10n-id")})}}}]).value("documentL10n",document.l10n)}(),function(root,factory){"function"==typeof define&&define.amd?define(["angular","sweetalert"],function(angular,sweetalert){return factory(angular,sweetalert)}):"object"==typeof module&&module.exports?module.exports=factory(require("angular"),require("sweetalert")):factory(root.angular,root.sweetAlert)}(this,function(ng,sweet){var service=function(){this.show=function(){var args=[].slice.call(arguments,0);sweet.apply(void 0,args)},ng.forEach(["showInputError","close"],function(func){this[func]=function(){var args=[].slice.call(arguments,0);sweet[func].apply(void 0,args)}},this),this.isShown=function(){var sweetAlertEl;return ng.forEach(document.getElementsByClassName("sweet-alert"),function(el){sweetAlertEl=ng.element(el)}),sweetAlertEl&&sweetAlertEl.hasClass("visible")}},modName="hSweetAlert";return ng.module(modName,[]).service("sweet",[service]),modName}),kimolecula.factory("KimoleculaModel",function($rootScope,kmlAPI){return{getLevel:function(actualLevel){return kmlAPI.getLevel(actualLevel)}}}),kimolecula.factory("kmlAPI",function($http){var makeHttp=function(url,data){return $http.defaults.headers.common["Content-Type"]="application/json",data||(data={}),$http({method:"GET",url:"levels/"+url,data:data}).then(function(response){return response.data},function(err){throw err})};return{getLevel:function(actualLevel){return makeHttp("kml-lvl-"+actualLevel+".json")}}});