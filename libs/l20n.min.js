!function(window,undefined){function define(name,payload){define.modules[name]=payload}function normalize(path){for(var parts=path.split("/"),normalized=[],i=0;i<parts.length;i++)"."==parts[i]||(".."==parts[i]?normalized.pop():normalized.push(parts[i]));return normalized.join("/")}function join(a,b){return a?a.trim().replace(/\/*$/,"/")+b.trim():b.trim()}function dirname(path){return path?path.split("/").slice(0,-1).join("/"):null}function req(leaf,name){if(name=normalize(join(dirname(leaf),name)),name in define.exports)return define.exports[name];if(!(name in define.modules))throw new Error("Module not defined: "+name);var module=define.modules[name];if("function"==typeof module){var exports={},reply=module(req.bind(null,name),exports,{id:name,uri:""});module=reply!==undefined?reply:exports}return define.exports[name]=module}define.modules={},define.exports={};var require=req.bind(null,null);define("l20n/html",function(require){"use strict";function waitFor(state,callback){return document.readyState===state?callback():void document.addEventListener("readystatechange",function(){document.readyState===state&&callback()})}function bindPublicAPI(ctx){DEBUG&&(ctx.addEventListener("error",console.error.bind(console)),ctx.addEventListener("warning",console.warn.bind(console))),ctx.localizeNode=function(node){for(var nodes=getNodes(node),many=localizeHandler.extend(nodes.ids),i=0;i<nodes.nodes.length;i++)translateNode(nodes.nodes[i],nodes.ids[i],many.entities[nodes.ids[i]])},ctx.once=function(callback){if(documentLocalized)callback();else{var callAndRemove=function callAndRemove(){document.removeEventListener("DocumentLocalized",callAndRemove),callback()};document.addEventListener("DocumentLocalized",callAndRemove)}},document.l10n=ctx}function bootstrap(){var headNode=document.head,data=headNode.querySelector('script[type="application/l10n-data+json"]');data&&ctx.updateData(JSON.parse(data.textContent));var link=headNode.querySelector('link[rel="localization"]');if(link)return loadManifest(link.href),collectNodes();var scripts=headNode.querySelectorAll('script[type="application/l20n"]');if(scripts.length){for(var i=0;i<scripts.length;i++)scripts[i].hasAttribute("src")?ctx.linkResource(scripts[i].src):ctx.addResource(scripts[i].textContent);return ctx.requestLocales(),collectNodes()}console.error("L20n: No resources found. (Put them above l20n.js.)")}function loadManifest(url){io.load(url,function(err,text){var manifest=parseManifest(text,url);setupCtxFromManifest(manifest)})}function parseManifest(text,url){var manifest=JSON.parse(text);return manifest.resources=manifest.resources.map(relativeToManifest.bind(this,url)),manifest}function setDocumentLanguage(loc){document.documentElement.lang=loc,document.documentElement.dir=rtlLocales.indexOf(loc)===-1?"ltr":"rtl"}function setupCtxFromManifest(manifest){ctx.registerLocales(manifest.default_locale,manifest.locales),ctx.registerLocaleNegotiator(function(available,requested,defLoc){var Intl=require("./intl").Intl,fallbackChain=Intl.prioritizeLocales(available,requested,defLoc);return setDocumentLanguage(fallbackChain[0]),fallbackChain});var re=/{{\s*locale\s*}}/;return manifest.resources.forEach(function(uri){re.test(uri)?ctx.linkResource(uri.replace.bind(uri,re)):ctx.linkResource(uri)}),ctx.requestLocales(navigator.language||navigator.browserLanguage),manifest}function relativeToManifest(manifestUrl,url){if(reAbsolute.test(url))return url;var dirs=manifestUrl.split("/").slice(0,-1).concat(url.split("/")).filter(function(elem){return"."!==elem});return dirs.join("/")}function fireLocalizedEvent(){var event=document.createEvent("Event");event.initEvent("DocumentLocalized",!1,!1),document.dispatchEvent(event)}function collectNodes(){var nodes=getNodes(document);localizeHandler=ctx.localize(nodes.ids,function(l10n){nodes||(nodes=getNodes(document));for(var i=0;i<nodes.nodes.length;i++)translateNode(nodes.nodes[i],nodes.ids[i],l10n.entities[nodes.ids[i]]);"locales"in l10n.reason&&l10n.reason.locales.length&&setDocumentLanguage(l10n.reason.locales[0]),nodes=null,documentLocalized||(documentLocalized=!0,fireLocalizedEvent())})}function getNodes(node){var nodes=node.querySelectorAll("[data-l10n-id]"),ids=[];node.hasAttribute&&node.hasAttribute("data-l10n-id")&&(nodes=Array.prototype.slice.call(nodes),nodes.push(node));for(var i=0;i<nodes.length;i++)ids.push(nodes[i].getAttribute("data-l10n-id"));return{ids:ids,nodes:nodes}}function camelCaseToDashed(string){return string.replace(/[A-Z]/g,function(match){return"-"+match.toLowerCase()}).replace(/^-/,"")}function translateNode(node,id,entity){if(entity){if(entity.value)if(entity.value.indexOf("<")===-1&&entity.value.indexOf("&")===-1||!templateSupported&&"function"!=typeof L20n.shims.getTemplate)node.textContent=entity.value;else{var translation=templateSupported?document.createElement("template"):L20n.shims.getTemplate();translation.innerHTML=entity.value,overlayElement(node,translation.content)}Object.keys(entity.attributes).forEach(function(key){var attrName=camelCaseToDashed(key);isAttrAllowed({name:attrName},node)&&node.setAttribute(attrName,entity.attributes[key])})}}function overlayElement(sourceElement,translationElement){for(var childElement,result=document.createDocumentFragment();childElement=translationElement.childNodes[0];)if(translationElement.removeChild(childElement),childElement.nodeType!==Node.TEXT_NODE){var sourceChild=getElementOfType(sourceElement,childElement);if(sourceChild)overlayElement(sourceChild,childElement),result.appendChild(sourceChild);else if(isElementAllowed(childElement)){for(var attr,k=0;attr=childElement.attributes[k];k++)isAttrAllowed(attr,childElement)||childElement.removeAttribute(attr.name);result.appendChild(childElement)}else{var text=document.createTextNode(childElement.textContent);result.appendChild(text)}}else result.appendChild(childElement);if(sourceElement.textContent="",sourceElement.appendChild(result),translationElement.attributes)for(var attr,k=0;attr=translationElement.attributes[k];k++)isAttrAllowed(attr,sourceElement)&&sourceElement.setAttribute(attr.name,attr.value)}function isElementAllowed(element){return whitelist.elements.indexOf(element.tagName.toLowerCase())!==-1}function isAttrAllowed(attr,element){var attrName=attr.name.toLowerCase(),tagName=element.tagName.toLowerCase();if(whitelist.attributes.global.indexOf(attrName)!==-1)return!0;if(!whitelist.attributes[tagName])return!1;if(whitelist.attributes[tagName].indexOf(attrName)!==-1)return!0;if("input"===tagName&&"value"===attrName){var type=element.type.toLowerCase();if("submit"===type||"button"===type||"reset"===type)return!0}return!1}function getElementOfType(context,element){for(var child,index=getIndexOfType(element),nthOfType=0,i=0;child=context.children[i];i++)if(child.nodeType===Node.ELEMENT_NODE&&child.tagName===element.tagName){if(nthOfType===index)return child;nthOfType++}return null}function getIndexOfType(element){for(var child,index=0;child=element.previousElementSibling;)child.tagName===element.tagName&&index++;return index}var DEBUG=!1,L20n=require("../l20n"),io=require("./platform/io");L20n.shims={};var reAbsolute=/^\/|:/,rtlLocales=["ar","fa","he","ps","ur"],whitelist={elements:["a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr"],attributes:{global:["title","aria-label"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]}},templateSupported="content"in document.createElement("template"),ctx=L20n.getContext(document.location.host);bindPublicAPI(ctx);var localizeHandler,documentLocalized=!1;return"complete"===document.readyState?window.setTimeout(bootstrap):waitFor("interactive",bootstrap),L20n}),define("l20n",function(require,exports){"use strict";var Context=require("./l20n/context").Context,Parser=require("./l20n/parser").Parser,Compiler=require("./l20n/compiler").Compiler;exports.Context=Context,exports.Parser=Parser,exports.Compiler=Compiler,exports.getContext=function(id){return new Context(id)}}),define("l20n/context",function(require,exports){"use strict";function Resource(id,parser){function build(nesting,callback,sync){function parse(err,text){return err?callback(err):(text!==undefined&&(self.source=text),self.ast=parser.parse(self.source),void buildImports())}function buildImports(){function resourceBuilt(err){return err?callback(err):(importsToBuild--,void(0===importsToBuild&&flatten()))}var imports=self.ast.body.filter(function(elem,i){return"ImportStatement"===elem.type&&(_imports_positions.push(i),!0)});imports.forEach(function(imp){var uri=relativeToSelf(imp.uri.content),res=new Resource(uri,parser);self.resources.push(res)});var importsToBuild=self.resources.length;return 0===importsToBuild?callback():void self.resources.forEach(function(res){res.build(nesting+1,resourceBuilt,sync)})}function flatten(){for(var i=self.resources.length-1;i>=0;i--){var pos=_imports_positions[i]||0;Array.prototype.splice.apply(self.ast.body,[pos,1].concat(self.resources[i].ast.body))}callback()}return nesting>=7?callback(new ContextError("Too many nested imports.")):self.source?setTimeout(function(){parse()}):void io.load(self.id,parse,sync)}function relativeToSelf(url){if(null===self.id||reAbsolute.test(url))return url;var dirs=self.id.split("/").slice(0,-1).concat(url.split("/")).filter(function(elem){return"."!==elem});return dirs.join("/")}var self=this;this.id=id,this.resources=[],this.source=null,this.ast={type:"L20n",body:[]},this.build=build;var _imports_positions=[],reAbsolute=/^\/|:/}function Locale(id,parser,compiler,emitter){function build(callback){function resourceBuilt(err){err&&(resourcesWithErrors++,emitter.emit(err instanceof ContextError?"error":"warning",err)),resourcesToBuild--,0===resourcesToBuild&&(resourcesWithErrors===self.resources.length&&emitter.emit("error",new ContextError("Locale has no valid resources")),flatten())}function flatten(){self.ast.body=self.resources.reduce(function(prev,curr){return prev.concat(curr.ast.body)},self.ast.body),compile()}function compile(){self.entries=compiler.compile(self.ast),self.isReady=!0,callback&&callback()}if(!callback)var sync=!0;var resourcesToBuild=self.resources.length;if(0===resourcesToBuild)throw new ContextError("Locale has no resources");var resourcesWithErrors=0;self.resources.forEach(function(res){res.build(0,resourceBuilt,sync)})}function getEntry(id){return this.entries.hasOwnProperty(id)?this.entries[id]:undefined}function hasResource(uri){return this.resources.some(function(res){return res.id===uri})}this.id=id,this.resources=[],this.entries=null,this.ast={type:"L20n",body:[]},this.isReady=!1,this.build=build,this.getEntry=getEntry,this.hasResource=hasResource;var self=this}function Context(id){function extend(dst,src){Object.keys(src).forEach(function(key){src[key]===undefined?delete dst[key]:null===src[key]||"object"!=typeof src[key]?dst[key]=src[key]:("object"!=typeof dst[key]&&(dst[key]={}),extend(dst[key],src[key]))})}function updateData(obj){if(!obj||"object"!=typeof obj)throw new ContextError("Context data must be a non-null object");extend(_data,obj)}function getSync(id,data){if(!_isReady)throw new ContextError("Context not ready");return getFromLocale.call(self,0,id,data).value}function getEntitySync(id,data){if(!_isReady)throw new ContextError("Context not ready");return getFromLocale.call(self,0,id,data)}function localize(ids,callback){if(!callback)throw new ContextError("No callback passed");return bindLocalize.call(self,ids,callback)}function ready(callback){_isReady&&setTimeout(function(){callback()}),addEvent("ready",callback)}function bindLocalize(ids,callback,reason){var bound={extend:function(newIds){for(var i=0;i<newIds.length;i++)ids.indexOf(newIds[i])===-1&&ids.push(newIds[i]);if(_isReady){var newMany=getMany.call(this,newIds);return _retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:Object.keys(newMany.globalsUsed)},!0),newMany}}.bind(this),stop:function(){_retr.unbindGet(callback)}.bind(this)};if(!_isReady)return _retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:[]}),bound;var many=getMany.call(this,ids),l10n={entities:many.entities,reason:reason||{locales:_fallbackChain.slice()},stop:function(){_retr.unbindGet(callback)}};return _retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:Object.keys(many.globalsUsed)}),callback(l10n),bound}function getMany(ids){for(var id,many={entities:{},globalsUsed:{}},i=0;id=ids[i];i++){many.entities[id]=getEntitySync.call(this,id);for(var global in many.entities[id].globals)many.entities[id].globals.hasOwnProperty(global)&&(many.globalsUsed[global]=!0)}return many}function getFromLocale(cur,id,data,prevSource){var loc=_fallbackChain[cur];if(!loc)return error(new RuntimeError("Unable to get translation",id,_fallbackChain)),{value:prevSource?prevSource.source:id,attributes:{},globals:{},locale:prevSource?prevSource.loc:null};var locale=getLocale(loc);locale.isReady||locale.build(null);var entry=locale.getEntry(id);if(entry===undefined)return warn(new TranslationError("Not found",id,_fallbackChain,locale)),getFromLocale.call(this,cur+1,id,data,prevSource);var value;try{value=entry.get(getArgs.call(this,data))}catch(e){if(e instanceof Compiler.RuntimeError){if(error(new TranslationError(e.message,id,_fallbackChain,locale)),e instanceof Compiler.ValueError){var source=prevSource||{source:e.source,loc:locale.id};return getFromLocale.call(this,cur+1,id,data,source)}return getFromLocale.call(this,cur+1,id,data,prevSource)}throw error(e)}return value.locale=locale.id,value}function getArgs(extra){if(!extra)return _data;var args={};return extend(args,_data),extend(args,extra),args}function addResource(text){if(_isFrozen)throw new ContextError("Context is frozen");_reslinks.push(["text",text])}function add(text,locale){var res=new Resource(null,_parser);res.source=text,locale.resources.push(res)}function linkResource(uri){if(_isFrozen)throw new ContextError("Context is frozen");_reslinks.push(["function"==typeof uri?"template":"uri",uri])}function link(uri,locale){if(!locale.hasResource(uri)){var res=new Resource(uri,_parser);locale.resources.push(res)}}function registerLocales(defLocale,available){if(_isFrozen)throw new ContextError("Context is frozen");defLocale!==undefined&&(_default=defLocale,_registered=[],available||(available=[]),available.push(defLocale),available.forEach(function(loc){if("string"!=typeof loc)throw new ContextError("Language codes must be strings");_registered.indexOf(loc)===-1&&_registered.push(loc)}))}function registerLocaleNegotiator(negotiator){if(_isFrozen)throw new ContextError("Context is frozen");_negotiator=negotiator}function getLocale(loc){if(_locales[loc])return _locales[loc];var locale=new Locale(loc,_parser,_compiler,_emitter);_locales[loc]=locale;for(var j=0;j<_reslinks.length;j++){var res=_reslinks[j];"text"===res[0]?add(res[1],locale):"uri"===res[0]?link(res[1],locale):link(res[1](locale.id),locale)}return locale}function requestLocales(){if(_isFrozen&&!_isReady)throw new ContextError("Context not ready");if(0===_reslinks.length)return void warn(new ContextError("Context has no resources; not freezing"));if(_isFrozen=!0,_requested=Array.prototype.slice.call(arguments),_requested.length&&_requested.forEach(function(loc){if("string"!=typeof loc)throw new ContextError("Language codes must be strings")}),!_negotiator){var Intl=require("./intl").Intl;_negotiator=Intl.prioritizeLocales}var fallbackChain=_negotiator(_registered,_requested,_default,freeze);fallbackChain&&freeze(fallbackChain)}function freeze(fallbackChain){var locale=getLocale(fallbackChain[0]);locale.isReady?setReady(fallbackChain):locale.build(setReady.bind(null,fallbackChain))}function setReady(fallbackChain){_fallbackChain=fallbackChain,_isReady=!0,_retr.all(_fallbackChain.slice()),_emitter.emit("ready")}function addEvent(type,listener){_emitter.addEventListener(type,listener)}function removeEvent(type,listener){_emitter.removeEventListener(type,listener)}function warn(e){return _emitter.emit("warning",e),e}function error(e){return _emitter.emit("error",e),e}this.id=id,this.registerLocales=registerLocales,this.registerLocaleNegotiator=registerLocaleNegotiator,this.requestLocales=requestLocales,this.addResource=addResource,this.linkResource=linkResource,this.updateData=updateData,this.getSync=getSync,this.getEntitySync=getEntitySync,this.localize=localize,this.ready=ready,this.addEventListener=addEvent,this.removeEventListener=removeEvent,Object.defineProperty(this,"supportedLocales",{get:function(){return _fallbackChain.slice()},enumerable:!0});var _negotiator,_data={},_default="i-default",_registered=[_default],_requested=[],_fallbackChain=[],_locales={},_reslinks=[],_isReady=!1,_isFrozen=!1,_emitter=new EventEmitter,_parser=new Parser,_compiler=new Compiler,_retr=new RetranslationManager,self=this;_parser.addEventListener("error",error),_compiler.addEventListener("error",warn),_compiler.setGlobals(_retr.globals)}function ContextError(message){this.name="ContextError",this.message=message}function RuntimeError(message,id,supported){ContextError.call(this,message),this.name="RuntimeError",this.entity=id,this.supportedLocales=supported.slice(),this.message=id+": "+message+"; tried "+supported.join(", ")}function TranslationError(message,id,supported,locale){RuntimeError.call(this,message,id,supported),this.name="TranslationError",this.locale=locale.id,this.message="["+this.locale+"] "+id+": "+message}var EventEmitter=require("./events").EventEmitter,Parser=require("./parser").Parser,Compiler=require("./compiler").Compiler,RetranslationManager=require("./retranslation").RetranslationManager;require("./platform/globals");var io=require("./platform/io");Context.Error=ContextError,Context.RuntimeError=RuntimeError,Context.TranslationError=TranslationError,ContextError.prototype=Object.create(Error.prototype),ContextError.prototype.constructor=ContextError,RuntimeError.prototype=Object.create(ContextError.prototype),RuntimeError.prototype.constructor=RuntimeError,TranslationError.prototype=Object.create(RuntimeError.prototype),TranslationError.prototype.constructor=TranslationError,exports.Context=Context}),define("l20n/events",function(require,exports){"use strict";function EventEmitter(){this._listeners={}}EventEmitter.prototype.emit=function(){var args=Array.prototype.slice.call(arguments),type=args.shift();if(!this._listeners[type])return!1;for(var typeListeners=this._listeners[type].slice(),i=0;i<typeListeners.length;i++)typeListeners[i].apply(this,args);return!0},EventEmitter.prototype.addEventListener=function(type,listener){return this._listeners[type]||(this._listeners[type]=[]),this._listeners[type].push(listener),this},EventEmitter.prototype.removeEventListener=function(type,listener){var typeListeners=this._listeners[type];if(!typeListeners)return this;var pos=typeListeners.indexOf(listener);return pos===-1?this:(typeListeners.splice(pos,1),this)},exports.EventEmitter=EventEmitter}),define("l20n/parser",function(require,exports){"use strict";function Parser(throwOnErrors){function getComment(){_index+=2;var start=_index,end=_source.indexOf("*/",start);if(end===-1)throw error("Comment without closing tag");return _index=end+2,{type:"Comment",content:_source.slice(start,end)}}function getAttributes(){for(var attr,ws1,ch,attrs=[];;){if(attr=getKVPWithIndex("Attribute"),attr.local="_"===attr.key.name.charAt(0),attrs.push(attr),ws1=getRequiredWS(),ch=_source.charAt(_index),">"===ch)break;if(!ws1)throw error('Expected ">"')}return attrs}function getKVP(type){var key=getIdentifier();if(getWS(),":"!==_source.charAt(_index))throw error('Expected ":"');return++_index,getWS(),{type:type,key:key,value:getValue()}}function getKVPWithIndex(type){var key=getIdentifier(),index=[];if("["===_source.charAt(_index)&&(++_index,getWS(),index=getItemList(getExpression,"]")),getWS(),":"!==_source.charAt(_index))throw error('Expected ":"');return++_index,getWS(),{type:type,key:key,value:getValue(),index:index}}function getHash(){++_index,getWS();for(var defItem,hi,comma,hash=[],hasDefItem=!1;;){if(defItem=!1,"*"===_source.charAt(_index)){if(++_index,hasDefItem)throw error("Default item redefinition forbidden");defItem=!0,hasDefItem=!0}if(hi=getKVP("HashItem"),hi.default=defItem,hash.push(hi),getWS(),comma=","===_source.charAt(_index),comma&&(++_index,getWS()),"}"===_source.charAt(_index)){++_index;break}if(!comma)throw error('Expected "}"')}return{type:"Hash",content:hash}}function _unescapeString(){var cc,ch=_source.charAt(++_index);if("u"===ch){for(var ucode="",i=0;i<4;i++){if(ch=_source[++_index],cc=ch.charCodeAt(0),!(cc>96&&cc<103||cc>64&&cc<71||cc>47&&cc<58))throw error("Illegal unicode escape sequence");ucode+=ch}return String.fromCharCode(parseInt(ucode,16))}return ch}function getComplexString(opchar,opcharLen){var ch,body=null,buf="",placeables=0;_index+=opcharLen-1;var start=_index+1;walkChars:for(;;)switch(ch=_source.charAt(++_index)){case"\\":buf+=_unescapeString();break;case"{":if("{"===_source.charAt(_index+1)){if(null===body&&(body=[]),placeables>MAX_PLACEABLES-1)throw error("Too many placeables, maximum allowed is "+MAX_PLACEABLES);if(buf&&body.push({type:"String",content:buf}),_index+=2,getWS(),body.push(getExpression()),getWS(),"}"!==_source.charAt(_index)||"}"!==_source.charAt(_index+1))throw error('Expected "}}"');_index+=1,placeables++,buf="";break}default:if(1===opcharLen){if(ch===opchar){_index++;break walkChars}}else if(ch===opchar[0]&&_source.charAt(_index+1)===ch&&_source.charAt(_index+2)===ch){_index+=3;break walkChars}if(buf+=ch,_index+1>=_length)throw error("Unclosed string literal")}return null===body?{type:"String",content:buf}:(buf.length&&body.push({type:"String",content:buf}),{type:"ComplexString",content:body,source:_source.slice(start,_index-opcharLen)})}function getString(opchar,opcharLen){var placeablePos,escPos,buf,opcharPos=_source.indexOf(opchar,_index+opcharLen);if(opcharPos===-1)throw error("Unclosed string literal");return buf=_source.slice(_index+opcharLen,opcharPos),placeablePos=buf.indexOf("{{"),placeablePos!==-1?getComplexString(opchar,opcharLen):(escPos=buf.indexOf("\\"),escPos!==-1?getComplexString(opchar,opcharLen):(_index=opcharPos+opcharLen,{type:"String",content:buf}))}function getValue(optional,ch){if(ch===undefined&&(ch=_source.charAt(_index)),"'"===ch||'"'===ch)return ch===_source.charAt(_index+1)&&ch===_source.charAt(_index+2)?getString(ch+ch+ch,3):getString(ch,1);if("{"===ch)return getHash();if(!optional)throw error("Unknown value type");return null}function getRequiredWS(){for(var pos=_index,cc=_source.charCodeAt(pos);32===cc||10===cc||9===cc||13===cc;)cc=_source.charCodeAt(++_index);return _index!==pos}function getWS(){for(var cc=_source.charCodeAt(_index);32===cc||10===cc||9===cc||13===cc;)cc=_source.charCodeAt(++_index)}function getVariable(){return++_index,{type:"VariableExpression",id:getIdentifier()}}function getIdentifier(){var index=_index,start=index,source=_source,cc=source.charCodeAt(start);if((cc<97||cc>122)&&(cc<65||cc>90)&&95!==cc)throw error("Identifier has to start with [a-zA-Z_]");for(cc=source.charCodeAt(++index);cc>=97&&cc<=122||cc>=65&&cc<=90||cc>=48&&cc<=57||95===cc;)cc=source.charCodeAt(++index);return _index=index,{type:"Identifier",name:source.slice(start,index)}}function getImportStatement(){if(_index+=6,"("!==_source.charAt(_index))throw error('Expected "("');++_index,getWS();var uri=getString(_source.charAt(_index),1);if(getWS(),")"!==_source.charAt(_index))throw error('Expected ")"');return++_index,{type:"ImportStatement",uri:uri}}function getMacro(id){if("_"===id.name.charAt(0))throw error('Macro ID cannot start with "_"');++_index;var idlist=getItemList(getVariable,")");if(getRequiredWS(),"{"!==_source.charAt(_index))throw error('Expected "{"');++_index,getWS();var exp=getExpression();if(getWS(),"}"!==_source.charAt(_index))throw error('Expected "}"');if(++_index,getWS(),62!==_source.charCodeAt(_index))throw error('Expected ">"');return++_index,{type:"Macro",id:id,args:idlist,expression:exp}}function getEntity(id,index){if(!getRequiredWS())throw error("Expected white space");var ch=_source.charAt(_index),value=getValue(!0,ch),attrs=null;if(null===value){if(">"===ch)throw error('Expected ">"');attrs=getAttributes()}else{var ws1=getRequiredWS();if(">"!==_source.charAt(_index)){if(!ws1)throw error('Expected ">"');attrs=getAttributes()}}return++_index,{type:"Entity",id:id,value:value,index:index,attrs:attrs,local:95===id.name.charCodeAt(0)}}function getEntry(){var cc=_source.charCodeAt(_index);if(60===cc){++_index;var id=getIdentifier();return cc=_source.charCodeAt(_index),40===cc?getMacro(id):91===cc?(++_index,getEntity(id,getItemList(getExpression,"]"))):getEntity(id,null)}if(47===_source.charCodeAt(_index)&&42===_source.charCodeAt(_index+1))return getComment();if("import"===_source.slice(_index,_index+6))return getImportStatement();throw error("Invalid entry")}function getL20nWithRecover(){var entries=[];for(getWS();_index<_length;){try{entries.push(getEntry())}catch(e){if(!(e instanceof ParserError))throw e;_emitter.emit("error",e),entries.push(recover())}_index<_length&&getWS()}return{type:"L20n",body:entries}}function getL20nPlain(){var entries=[];for(getWS();_index<_length;)entries.push(getEntry()),_index<_length&&getWS();return{type:"L20n",body:entries}}function parse(string){return _source=string,_index=0,_length=_source.length,getL20n()}function addEvent(type,listener){if(!_emitter)throw new Error("Emitter not available");return _emitter.addEventListener(type,listener)}function removeEvent(type,listener){if(!_emitter)throw new Error("Emitter not available");return _emitter.removeEventListener(type,listener)}function getExpression(){return getConditionalExpression()}function getPrefixExpression(token,cl,op,nxt){for(var t,ch,exp=nxt();;){if(t="",getWS(),ch=_source.charAt(_index),token[0].indexOf(ch)===-1)break;if(t+=ch,++_index,token.length>1)if(ch=_source.charAt(_index),token[1]===ch)++_index,t+=ch;else if(token[2])return--_index,exp;getWS(),exp={type:cl,operator:{type:op,token:t},left:exp,right:nxt()}}return exp}function getPostfixExpression(token,cl,op,nxt){var cc=_source.charCodeAt(_index);return token.indexOf(cc)===-1?nxt():(++_index,getWS(),{type:cl,operator:{type:op,token:String.fromCharCode(cc)},argument:getPostfixExpression(token,cl,op,nxt)})}function getConditionalExpression(){var exp=getOrExpression();if(getWS(),63!==_source.charCodeAt(_index))return exp;++_index,getWS();var consequent=getExpression();if(getWS(),58!==_source.charCodeAt(_index))throw error('Expected ":"');return++_index,getWS(),{type:"ConditionalExpression",test:exp,consequent:consequent,alternate:getExpression()}}function getOrExpression(){return getPrefixExpression([["|"],"|",!0],"LogicalExpression","LogicalOperator",getAndExpression)}function getAndExpression(){return getPrefixExpression([["&"],"&",!0],"LogicalExpression","Logicalperator",getEqualityExpression)}function getEqualityExpression(){return getPrefixExpression([["=","!"],"=",!0],"BinaryExpression","BinaryOperator",getRelationalExpression)}function getRelationalExpression(){return getPrefixExpression([["<",">"],"=",!1],"BinaryExpression","BinaryOperator",getAdditiveExpression)}function getAdditiveExpression(){return getPrefixExpression([["+","-"]],"BinaryExpression","BinaryOperator",getModuloExpression)}function getModuloExpression(){return getPrefixExpression([["%"]],"BinaryExpression","BinaryOperator",getMultiplicativeExpression)}function getMultiplicativeExpression(){return getPrefixExpression([["*"]],"BinaryExpression","BinaryOperator",getDividiveExpression)}function getDividiveExpression(){return getPrefixExpression([["/"]],"BinaryExpression","BinaryOperator",getUnaryExpression)}function getUnaryExpression(){return getPostfixExpression([43,45,33],"UnaryExpression","UnaryOperator",getMemberExpression)}function getCallExpression(callee){return getWS(),{type:"CallExpression",callee:callee,arguments:getItemList(getExpression,")")}}function getAttributeExpression(idref,computed){if("ParenthesisExpression"!==idref.type&&"Identifier"!==idref.type&&"ThisExpression"!==idref.type)throw error("AttributeExpression must have Identifier, This or Parenthesis as left node");var exp;if(computed){if(getWS(),exp=getExpression(),getWS(),"]"!==_source.charAt(_index))throw error('Expected "]"');return++_index,{type:"AttributeExpression",expression:idref,attribute:exp,computed:!0}}return exp=getIdentifier(),{type:"AttributeExpression",expression:idref,attribute:exp,computed:!1}}function getPropertyExpression(idref,computed){var exp;if(computed){if(getWS(),exp=getExpression(),getWS(),"]"!==_source.charAt(_index))throw error('Expected "]"');return++_index,{type:"PropertyExpression",expression:idref,property:exp,computed:!0}}return exp=getIdentifier(),{type:"PropertyExpression",expression:idref,property:exp,computed:!1}}function getMemberExpression(){for(var cc,exp=getParenthesisExpression();;)if(cc=_source.charCodeAt(_index),46===cc||91===cc)++_index,exp=getPropertyExpression(exp,91===cc);else if(58===cc&&58===_source.charCodeAt(_index+1))_index+=2,91===_source.charCodeAt(_index)?(++_index,exp=getAttributeExpression(exp,!0)):exp=getAttributeExpression(exp,!1);else{if(40!==cc)break;++_index,exp=getCallExpression(exp)}return exp}function getParenthesisExpression(){if(40===_source.charCodeAt(_index)){++_index,getWS();var pexp={type:"ParenthesisExpression",expression:getExpression()};if(getWS(),41!==_source.charCodeAt(_index))throw error('Expected ")"');return++_index,pexp}return getPrimaryExpression()}function getPrimaryExpression(){for(var pos=_index,cc=_source.charCodeAt(pos);cc>47&&cc<58;)cc=_source.charCodeAt(++pos);if(pos>_index){var start=_index;return _index=pos,{type:"Number",value:parseInt(_source.slice(start,pos),10)}}switch(cc){case 39:case 34:case 123:case 91:return getValue();case 36:return getVariable();case 64:return++_index,{type:"GlobalsExpression",id:getIdentifier()};case 126:return++_index,{type:"ThisExpression"};default:return getIdentifier()}}function getItemList(callback,closeChar){var ch;if(getWS(),_source.charAt(_index)===closeChar)return++_index,[];for(var items=[];;){if(items.push(callback()),getWS(),ch=_source.charAt(_index),","!==ch){if(ch===closeChar){++_index;break}throw error('Expected "," or "'+closeChar+'"')}++_index,getWS()}return items}function error(message,pos){pos===undefined&&(pos=_index);var start=_source.lastIndexOf("<",pos-1),lastClose=_source.lastIndexOf(">",pos-1);start=lastClose>start?lastClose+1:start;var context=_source.slice(start,pos+10),msg=message+" at pos "+pos+': "'+context+'"';return new ParserError(msg,pos,context)}function recover(){var junk,opening=_source.indexOf("<",_index);return opening===-1?(junk={type:"JunkEntry",content:_source.slice(_index)},_index=_length,junk):(junk={type:"JunkEntry",content:_source.slice(_index,opening)},_index=opening,junk)}this.parse=parse,this.addEventListener=addEvent,this.removeEventListener=removeEvent;var _source,_index,_length,_emitter,getL20n,MAX_PLACEABLES=100;throwOnErrors?getL20n=getL20nPlain:(_emitter=new EventEmitter,getL20n=getL20nWithRecover)}function ParserError(message,pos,context){this.name="ParserError",this.message=message,this.pos=pos,this.context=context}var EventEmitter=require("./events").EventEmitter;Parser.Error=ParserError,ParserError.prototype=Object.create(Error.prototype),ParserError.prototype.constructor=ParserError,exports.Parser=Parser}),define("l20n/compiler",function(require,exports){function Compiler(){function compile(ast,env){env||(env={});for(var entry,i=0;entry=ast.body[i];i++){var Constructor=_entryTypes[entry.type];if(Constructor)try{env[entry.id.name]=new Constructor(entry,env);
}catch(e){requireCompilerError(e)}}return env}function setGlobals(globals){return _globals=globals,!0}function addEvent(type,listener){return _emitter.addEventListener(type,listener)}function removeEvent(type,listener){return _emitter.removeEventListener(type,listener)}function emit(Ctor,message,entry,source){var e=new Ctor(message,entry,source);return _emitter.emit("error",e),e}function Entity(node,env){this.id=node.id.name,this.env=env,this.local=node.local||!1,this.index=null,this.attributes=null,this.publicAttributes=null;var i;if(node.index)for(this.index=[],i=0;i<node.index.length;i++)this.index.push(IndexExpression(node.index[i],this));if(node.attrs)for(this.attributes={},this.publicAttributes=[],i=0;i<node.attrs.length;i++){var attr=node.attrs[i];this.attributes[attr.key.name]=new Attribute(attr,this),attr.local||this.publicAttributes.push(attr.key.name)}node.value&&"String"===node.value.type?this.value=node.value.content:this.value=LazyExpression(node.value,this,this.index)}function Attribute(node,entity){if(this.key=node.key.name,this.local=node.local||!1,this.index=null,node.index){this.index=[];for(var i=0;i<node.index.length;i++)this.index.push(IndexExpression(node.index[i],this))}node.value&&"String"===node.value.type?this.value=node.value.content:this.value=LazyExpression(node.value,entity,this.index),this.entity=entity}function Macro(node,env){this.id=node.id.name,this.env=env,this.local=node.local||!1,this.expression=LazyExpression(node.expression,this),this.args=node.args}function Expression(node,entry,index){if(!node)return null;if(!EXPRESSION_TYPES[node.type])throw emit("CompilationError","Unknown expression type"+node.type);return index&&(index=index.slice()),EXPRESSION_TYPES[node.type](node,entry,index)}function LazyExpression(node,entry,index){if(!node)return null;var expr;return function(locals,ctxdata,prop){return expr||(expr=Expression(node,entry,index)),expr(locals,ctxdata,prop)}}function _resolve(expr,locals,ctxdata){if("string"==typeof expr||"boolean"==typeof expr||"number"==typeof expr||!expr)return expr;if(expr.value!==undefined)return _resolve(expr.value,locals,ctxdata);if("function"==typeof expr){var current=expr(locals,ctxdata);return locals=current[0],current=current[1],_resolve(current,locals,ctxdata)}if(expr.expression)throw new RuntimeError("Uncalled macro: "+expr.id);throw new RuntimeError("Cannot resolve ctxdata or global of type "+typeof expr)}function Identifier(node){var name=node.name;return function(locals){if(!locals.__env__.hasOwnProperty(name))throw new RuntimeError("Reference to an unknown entry: "+name);return locals={__this__:locals.__env__[name],__env__:locals.__env__},[locals,locals.__this__]}}function ThisExpression(){return function(locals){return[locals,locals.__this__]}}function VariableExpression(node){var name=node.id.name;return function(locals,ctxdata){if(locals.hasOwnProperty(name))return locals[name];if(!ctxdata||!ctxdata.hasOwnProperty(name))throw new RuntimeError("Reference to an unknown variable: "+name);return[locals,ctxdata[name]]}}function GlobalsExpression(node){var name=node.id.name;return function(locals){if(!_globals)throw new RuntimeError("No globals set (tried @"+name+")");if(!_globals.hasOwnProperty(name))throw new RuntimeError("Reference to an unknown global: "+name);var value;try{value=_globals[name].get()}catch(e){throw new RuntimeError("Cannot evaluate global "+name)}return _references.globals[name]=!0,[locals,value]}}function NumberLiteral(node){return function(locals){return[locals,node.value]}}function StringLiteral(node){return function(locals,ctxdata,key){if(key!==undefined)throw new RuntimeError("Cannot get property of a string: "+key);return[locals,node.content]}}function ComplexString(node,entry){for(var content=[],i=0;i<node.content.length;i++)content.push(Expression(node.content[i],entry));return function(){var dirty=!1;return function(locals,ctxdata,key){if(key!==undefined)throw new RuntimeError("Cannot get property of a string: "+key);if(dirty)throw new RuntimeError("Cyclic reference detected");dirty=!0;var parts=[];try{for(var i=0;i<content.length;i++){var part=_resolve(content[i],locals,ctxdata);if("string"!=typeof part&&"number"!=typeof part)throw new RuntimeError("Placeables must be strings or numbers");if(part.length>MAX_PLACEABLE_LENGTH)throw new RuntimeError("Placeable has too many characters, maximum allowed is "+MAX_PLACEABLE_LENGTH);parts.push(part)}}catch(e){throw requireCompilerError(e),new ValueError(e.message,entry,node.source)}finally{dirty=!1}return[locals,parts.join("")]}}()}function IndexExpression(node,entry){var expression=Expression(node,entry);return function(){var dirty=!1;return function(locals,ctxdata){if(dirty)throw new RuntimeError("Cyclic reference detected");dirty=!0;var retval;try{retval=_resolve(expression,locals,ctxdata)}catch(e){if(e instanceof IndexError)throw e;throw requireCompilerError(e),emit(IndexError,e.message,entry)}finally{dirty=!1}return[locals,retval]}}()}function HashLiteral(node,entry,index){for(var defaultKey,content={},defaultIndex=index?index.shift():undefined,i=0;i<node.content.length;i++){var elem=node.content[i];content[elem.key.name]=Expression(elem.value,entry,index),elem.default&&(defaultKey=elem.key.name)}return function(locals,ctxdata,prop){for(var keysToTry=[prop,defaultIndex,defaultKey],keysTried=[],i=0;i<keysToTry.length;i++){var key=_resolve(keysToTry[i],locals,ctxdata);if(key!==undefined){if("string"!=typeof key)throw emit(IndexError,"Index must be a string",entry);if(keysTried.push(key),content.hasOwnProperty(key))return[locals,content[key]]}}var message;throw message=keysTried.length?'Hash key lookup failed (tried "'+keysTried.join('", "')+'").':"Hash key lookup failed.",emit(IndexError,message,entry)}}function UnaryOperator(token,entry){if("-"===token)return function(argument){if("number"!=typeof argument)throw new RuntimeError("The unary - operator takes a number");return-argument};if("+"===token)return function(argument){if("number"!=typeof argument)throw new RuntimeError("The unary + operator takes a number");return+argument};if("!"===token)return function(argument){if("boolean"!=typeof argument)throw new RuntimeError("The ! operator takes a boolean");return!argument};throw emit(CompilationError,"Unknown token: "+token,entry)}function BinaryOperator(token,entry){if("=="===token)return function(left,right){if(!("number"==typeof left&&"number"==typeof right||"string"==typeof left&&"string"==typeof right))throw new RuntimeError("The == operator takes two numbers or two strings");return left===right};if("!="===token)return function(left,right){if(!("number"==typeof left&&"number"==typeof right||"string"==typeof left&&"string"==typeof right))throw new RuntimeError("The != operator takes two numbers or two strings");return left!==right};if("<"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The < operator takes two numbers");return left<right};if("<="===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The <= operator takes two numbers");return left<=right};if(">"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The > operator takes two numbers");return left>right};if(">="===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The >= operator takes two numbers");return left>=right};if("+"===token)return function(left,right){if(!("number"==typeof left&&"number"==typeof right||"string"==typeof left&&"string"==typeof right))throw new RuntimeError("The + operator takes two numbers or two strings");return left+right};if("-"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The - operator takes two numbers");return left-right};if("*"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The * operator takes two numbers");return left*right};if("/"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The / operator takes two numbers");if(0===right)throw new RuntimeError("Division by zero not allowed.");return left/right};if("%"===token)return function(left,right){if("number"!=typeof left||"number"!=typeof right)throw new RuntimeError("The % operator takes two numbers");if(0===right)throw new RuntimeError("Modulo zero not allowed.");return left%right};throw emit(CompilationError,"Unknown token: "+token,entry)}function LogicalOperator(token,entry){if("&&"===token)return function(left,right){if("boolean"!=typeof left||"boolean"!=typeof right)throw new RuntimeError("The && operator takes two booleans");return left&&right};if("||"===token)return function(left,right){if("boolean"!=typeof left||"boolean"!=typeof right)throw new RuntimeError("The || operator takes two booleans");return left||right};throw emit(CompilationError,"Unknown token: "+token,entry)}function UnaryExpression(node,entry){var operator=UnaryOperator(node.operator.token,entry),argument=Expression(node.argument,entry);return function(locals,ctxdata){return[locals,operator(_resolve(argument,locals,ctxdata))]}}function BinaryExpression(node,entry){var left=Expression(node.left,entry),operator=BinaryOperator(node.operator.token,entry),right=Expression(node.right,entry);return function(locals,ctxdata){return[locals,operator(_resolve(left,locals,ctxdata),_resolve(right,locals,ctxdata))]}}function LogicalExpression(node,entry){var left=Expression(node.left,entry),operator=LogicalOperator(node.operator.token,entry),right=Expression(node.right,entry);return function(locals,ctxdata){return[locals,operator(_resolve(left,locals,ctxdata),_resolve(right,locals,ctxdata))]}}function ConditionalExpression(node,entry){var test=Expression(node.test,entry),consequent=Expression(node.consequent,entry),alternate=Expression(node.alternate,entry);return function(locals,ctxdata){var tested=_resolve(test,locals,ctxdata);if("boolean"!=typeof tested)throw new RuntimeError("Conditional expressions must test a boolean");return tested===!0?consequent(locals,ctxdata):alternate(locals,ctxdata)}}function CallExpression(node,entry){for(var callee=Expression(node.callee,entry),args=[],i=0;i<node.arguments.length;i++)args.push(Expression(node.arguments[i],entry));return function(locals,ctxdata){for(var evaluated_args=[],i=0;i<args.length;i++)evaluated_args.push(args[i](locals,ctxdata));var macro=callee(locals,ctxdata);if(locals=macro[0],macro=macro[1],!macro.expression)throw new RuntimeError("Expected a macro, got a non-callable.");return macro._call(evaluated_args,ctxdata)}}function PropertyExpression(node,entry){var expression=Expression(node.expression,entry),property=node.computed?Expression(node.property,entry):node.property.name;return function(locals,ctxdata){var prop=_resolve(property,locals,ctxdata);if("string"!=typeof prop)throw new RuntimeError("Property name must evaluate to a string: "+prop);var parent=expression(locals,ctxdata);if(locals=parent[0],parent=parent[1],parent&&parent.value!==undefined){if("function"!=typeof parent.value)throw new RuntimeError("Cannot get property of a "+typeof parent.value+": "+prop);return parent.value(locals,ctxdata,prop)}if("function"==typeof parent)return parent(locals,ctxdata,prop);if(parent&&parent.expression)throw new RuntimeError("Cannot get property of a macro: "+prop);if("object"==typeof parent){if(null===parent)throw new RuntimeError("Cannot get property of a null: "+prop);if(Array.isArray(parent))throw new RuntimeError("Cannot get property of an array: "+prop);if(!parent.hasOwnProperty(prop))throw new RuntimeError(prop+" is not defined on the object.");return[locals,parent[prop]]}throw new RuntimeError("Cannot get property of a "+typeof parent+": "+prop)}}function AttributeExpression(node,entry){var expression=Expression(node.expression,entry),attribute=node.computed?Expression(node.attribute,entry):node.attribute.name;return function(locals,ctxdata){var attr=_resolve(attribute,locals,ctxdata),entity=expression(locals,ctxdata);if(locals=entity[0],entity=entity[1],!entity.attributes)throw new RuntimeError("Cannot get attribute of a non-entity: "+attr);if(!entity.attributes.hasOwnProperty(attr))throw new RuntimeError(entity.id+" has no attribute "+attr);return[locals,entity.attributes[attr]]}}function ParenthesisExpression(node,entry){return Expression(node.expression,entry)}this.compile=compile,this.setGlobals=setGlobals,this.addEventListener=addEvent,this.removeEventListener=removeEvent;var MAX_PLACEABLE_LENGTH=2500,_emitter=new EventEmitter,_globals=null,_references={globals:{}},_entryTypes={Entity:Entity,Macro:Macro};Entity.prototype.getString=function(ctxdata){try{var locals={__this__:this,__env__:this.env};return _resolve(this.value,locals,ctxdata)}catch(e){throw requireCompilerError(e),e instanceof ValueError&&_emitter.emit("error",e),e}},Entity.prototype.get=function(ctxdata){_references.globals={};var entity={value:this.getString(ctxdata),attributes:{}};if(this.publicAttributes){entity.attributes={};for(var attr,i=0;attr=this.publicAttributes[i];i++)entity.attributes[attr]=this.attributes[attr].getString(ctxdata)}return entity.globals=_references.globals,entity},Attribute.prototype.getString=function(ctxdata){try{var locals={__this__:this.entity,__env__:this.entity.env};return _resolve(this.value,locals,ctxdata)}catch(e){throw requireCompilerError(e),e instanceof ValueError&&_emitter.emit("error",e),e}},Macro.prototype._call=function(args,ctxdata){var locals={__this__:this,__env__:this.env};if(this.args.length!==args.length)throw new RuntimeError(this.id+"() takes exactly "+this.args.length+" argument(s) ("+args.length+" given)");for(var i=0;i<this.args.length;i++)locals[this.args[i].id.name]=args[i];var final=this.expression(locals,ctxdata);return locals=final[0],final=final[1],[locals,_resolve(final,locals,ctxdata)]};var EXPRESSION_TYPES={Identifier:Identifier,ThisExpression:ThisExpression,VariableExpression:VariableExpression,GlobalsExpression:GlobalsExpression,Number:NumberLiteral,String:StringLiteral,Hash:HashLiteral,HashItem:Expression,ComplexString:ComplexString,UnaryExpression:UnaryExpression,BinaryExpression:BinaryExpression,LogicalExpression:LogicalExpression,ConditionalExpression:ConditionalExpression,CallExpression:CallExpression,PropertyExpression:PropertyExpression,AttributeExpression:AttributeExpression,ParenthesisExpression:ParenthesisExpression}}function CompilerError(message){this.name="CompilerError",this.message=message}function CompilationError(message,entry){CompilerError.call(this,message),this.name="CompilationError",this.entry=entry.id}function RuntimeError(message){CompilerError.call(this,message),this.name="RuntimeError"}function ValueError(message,entry,source){RuntimeError.call(this,message),this.name="ValueError",this.entry=entry.id,this.source=source}function IndexError(message,entry){RuntimeError.call(this,message),this.name="IndexError",this.entry=entry.id}function requireCompilerError(e){if(!(e instanceof CompilerError))throw e}var EventEmitter=require("./events").EventEmitter;Compiler.Error=CompilerError,Compiler.CompilationError=CompilationError,Compiler.RuntimeError=RuntimeError,Compiler.ValueError=ValueError,Compiler.IndexError=IndexError,CompilerError.prototype=Object.create(Error.prototype),CompilerError.prototype.constructor=CompilerError,CompilationError.prototype=Object.create(CompilerError.prototype),CompilationError.prototype.constructor=CompilationError,RuntimeError.prototype=Object.create(CompilerError.prototype),RuntimeError.prototype.constructor=RuntimeError,ValueError.prototype=Object.create(RuntimeError.prototype),ValueError.prototype.constructor=ValueError,IndexError.prototype=Object.create(RuntimeError.prototype),IndexError.prototype.constructor=IndexError,exports.Compiler=Compiler}),define("l20n/retranslation",function(require,exports){"use strict";function RetranslationManager(){function initGlobal(GlobalCtor){var global=new GlobalCtor;this.globals[global.id]=global,global.activate&&(_counter[global.id]=0,global.addEventListener("change",function(id){for(var i=0;i<_usage.length;i++)_usage[i]&&_usage[i].globals.indexOf(id)!==-1&&_usage[i].callback({global:global.id})}))}function bindGet(get,isRebind){var i,inCallbacks;for(i=0;i<_callbacks.length;i++)if(_callbacks[i].id===get.id){inCallbacks=!0;break}inCallbacks?isRebind&&(_callbacks[i]=get):_callbacks.push(get);var bound;for(i=0;i<_usage.length;i++)if(_usage[i]&&_usage[i].id===get.id){bound=_usage[i];break}var added;if(bound)if(isRebind)bound.callback=get.callback,added=get.globals.filter(function(id){return this.globals[id].activate&&bound.globals.indexOf(id)===-1},this),added.forEach(function(id){_counter[id]++,this.globals[id].activate()},this),bound.globals=bound.globals.concat(added);else if(0===get.globals.length)delete _usage[i];else{added=get.globals.filter(function(id){return this.globals[id].activate&&bound.globals.indexOf(id)===-1},this),added.forEach(function(id){_counter[id]++,this.globals[id].activate()},this);var removed=bound.globals.filter(function(id){return this.globals[id].activate&&get.globals.indexOf(id)===-1},this);removed.forEach(function(id){_counter[id]--,0===_counter[id]&&this.globals[id].deactivate()},this),bound.globals=get.globals}else 0!==get.globals.length&&(_usage.push(get),get.globals.forEach(function(id){this.globals[id].activate&&(_counter[id]++,this.globals[id].activate())},this))}function unbindGet(id){for(var bound,usagePos=-1,i=0;i<_usage.length;i++)if(_usage[i]&&_usage[i].id===id){bound=_usage[i],usagePos=i;break}if(bound)for(bound.globals.forEach(function(id){this.globals[id].activate&&(_counter[id]--,0===_counter[id]&&this.globals[id].deactivate())},this),_usage.splice(usagePos,1),i=0;i<_callbacks.length;i++)if(_callbacks[i].id===id){_callbacks.splice(i,1);break}}function all(locales){for(var i=0;i<_callbacks.length;i++)_callbacks[i].callback({locales:locales})}var _usage=[],_counter={},_callbacks=[];this.bindGet=bindGet,this.unbindGet=unbindGet,this.all=all,this.globals={},RetranslationManager._constructors.forEach(function(ctor){initGlobal.call(this,ctor)},this)}RetranslationManager._constructors=[],RetranslationManager.registerGlobal=function(ctor){RetranslationManager._constructors.push(ctor)},RetranslationManager.deregisterGlobal=function(ctor){var pos=RetranslationManager._constructors.indexOf(ctor);pos!==-1&&RetranslationManager._constructors.splice(pos,1)},exports.RetranslationManager=RetranslationManager}),define("l20n/platform/globals",function(require,exports){"use strict";function Global(){this.id=null,this._emitter=new EventEmitter,this.value=null,this.isActive=!1}function ScreenGlobal(){function _get(){return{width:{px:document.body.clientWidth}}}function onchange(){self.value=_get(),self._emitter.emit("change",self.id)}Global.call(this),this.id="screen",this._get=_get,this.activate=function(){this.isActive||(window.addEventListener("resize",onchange),this.isActive=!0)},this.deactivate=function(){window.removeEventListener("resize",onchange),this.value=null,this.isActive=!1};var self=this}function OSGlobal(){function get(){return/^MacIntel/.test(navigator.platform)?"mac":/^Linux/.test(navigator.platform)?"linux":/^Win/.test(navigator.platform)?"win":"unknown"}Global.call(this),this.id="os",this.get=get}function HourGlobal(){function _get(){var time=new Date;return time.getHours()}function onchange(){var time=new Date;time.getHours()!==self.value&&(self.value=time.getHours(),self._emitter.emit("change",self.id))}Global.call(this),this.id="hour",this._get=_get,this.activate=function(){if(!this.isActive){var time=new Date;I=setTimeout(function(){onchange(),I=setInterval(onchange,interval)},interval-time.getTime()%interval),this.isActive=!0}},this.deactivate=function(){clearInterval(I),this.value=null,this.isActive=!1};var self=this,interval=36e5,I=null}var EventEmitter=require("../events").EventEmitter,RetranslationManager=require("../retranslation").RetranslationManager;Global.prototype._get=function(){throw new Error("Not implemented")},Global.prototype.get=function(){return this.value&&this.isActive||(this.value=this._get()),this.value},Global.prototype.addEventListener=function(type,listener){if("change"!==type)throw"Unknown event type";this._emitter.addEventListener(type,listener)},ScreenGlobal.prototype=Object.create(Global.prototype),ScreenGlobal.prototype.constructor=ScreenGlobal,OSGlobal.prototype=Object.create(Global.prototype),OSGlobal.prototype.constructor=OSGlobal,HourGlobal.prototype=Object.create(Global.prototype),HourGlobal.prototype.constructor=HourGlobal,RetranslationManager.registerGlobal(ScreenGlobal),RetranslationManager.registerGlobal(OSGlobal),RetranslationManager.registerGlobal(HourGlobal),exports.Global=Global}),define("l20n/platform/io",function(require,exports){"use strict";function IOError(message){this.name="IOError",this.message=message}exports.load=function(url,callback,sync){var xhr=new XMLHttpRequest;xhr.overrideMimeType&&xhr.overrideMimeType("text/plain"),xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status||0===xhr.status)callback(null,xhr.responseText);else{var ex=new IOError("Not found: "+url);callback(ex)}},xhr.open("GET",url,!sync),xhr.send("")},IOError.prototype=Object.create(Error.prototype),IOError.prototype.constructor=IOError,exports.Error=IOError}),define("l20n/intl",function(require,exports,module){"use strict";function IsStructurallyValidLanguageTag(locale){if(!languageTagRE.test(locale))return!1;if(locale.startsWith("x-"))return!0;var pos=locale.indexOf("-x-");return pos!==-1&&(locale=locale.substring(0,pos)),!duplicateVariantRE.test(locale)&&!duplicateSingletonRE.test(locale)}function CanonicalizeLanguageTag(locale){if(locale=locale.toLowerCase(),langTagMappings&&langTagMappings.hasOwnProperty(locale))return langTagMappings[locale];for(var subtags=locale.split("-"),i=0;i<subtags.length;){var subtag=subtags[i];if(1===subtag.length&&(i>0||"x"===subtag))break;4===subtag.length?subtag=subtag[0].toUpperCase()+subtag.substring(1):0!==i&&2===subtag.length&&(subtag=subtag.toUpperCase()),langSubtagMappings.hasOwnProperty(subtag)?subtag=langSubtagMappings[subtag]:extlangMappings.hasOwnProperty(subtag)&&(subtag=extlangMappings[subtag].preferred,1===i&&extlangMappings[subtag].prefix===subtags[0]&&(subtags.shift(),i--)),subtags[i]=subtag,i++}for(var normal=subtags.slice(0,i).join("-"),extensions=[];i<subtags.length&&"x"!==subtags[i];){var extensionStart=i;for(i++;i<subtags.length&&subtags[i].length>1;)i++;var extension=sybtags.slice(extensionStart,i).join("-");extensions.push(extension)}extensions.sort();var privateUse="";i<subtags.length&&(privateUse=subtags.slice(i).join("-"));var canonical=normal;return extensions.length>0&&(canonical+="-"+extensions.join("-")),privateUse.length>0&&(canonical.length>0?canonical+="-"+privateUse:canonical=privateUse),canonical}function CanonicalizeLocaleList(locales){if(locales===undefined)return[];var seen=[];"string"==typeof locales&&(locales=[locales]);for(var O=locales,len=O.length,k=0;k<len;){var kPresent=k in O;if(kPresent){var kValue=O[k];"string"!=typeof kValue&&"object"!=typeof kValue&&ThrowError(JSMSG_INVALID_LOCALES_ELEMENT);var tag=kValue;IsStructurallyValidLanguageTag(tag)||ThrowError(JSMSG_INVALID_LANGUAGE_TAG,tag),tag=CanonicalizeLanguageTag(tag),seen.indexOf(tag)===-1&&seen.push(tag)}k++}return seen}function BestAvailableLocale(availableLocales,locale){for(var candidate=locale;;){if(availableLocales.indexOf(candidate)!==-1)return candidate;var pos=candidate.lastIndexOf("-");if(pos===-1)return undefined;pos>=2&&"-"===candidate[pos-2]&&(pos-=2),candidate=candidate.substring(0,pos)}}function LookupAvailableLocales(availableLocales,requestedLocales){for(var len=requestedLocales.length,subset=[],k=0;k<len;){var locale=requestedLocales[k],noExtensionsLocale=locale.replace(unicodeLocaleExtensionSequenceGlobalRE,""),availableLocale=BestAvailableLocale(availableLocales,noExtensionsLocale);availableLocale!==undefined&&subset.push(availableLocale),k++}return subset.slice(0)}function PrioritizeLocales(availableLocales,requestedLocales,defaultLocale){availableLocales=CanonicalizeLocaleList(availableLocales),requestedLocales=CanonicalizeLocaleList(requestedLocales);var result=LookupAvailableLocales(availableLocales,requestedLocales);return defaultLocale?(defaultLocale=CanonicalizeLanguageTag(defaultLocale),result.indexOf(defaultLocale)===-1&&result.push(defaultLocale),result):result}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(searchString,position){return position=position||0,this.indexOf(searchString,position)===position}});var unicodeLocaleExtensionSequence="-u(-[a-z0-9]{2,8})+",unicodeLocaleExtensionSequenceGlobalRE=(new RegExp(unicodeLocaleExtensionSequence),new RegExp(unicodeLocaleExtensionSequence,"g")),langTagMappings={},langSubtagMappings={},extlangMappings={},languageTagRE=function(){var ALPHA="[a-zA-Z]",DIGIT="[0-9]",alphanum="(?:"+ALPHA+"|"+DIGIT+")",regular="(?:art-lojban|cel-gaulish|no-bok|no-nyn|zh-guoyu|zh-hakka|zh-min|zh-min-nan|zh-xiang)",irregular="(?:en-GB-oed|i-ami|i-bnn|i-default|i-enochian|i-hak|i-klingon|i-lux|i-mingo|i-navajo|i-pwn|i-tao|i-tay|i-tsu|sgn-BE-FR|sgn-BE-NL|sgn-CH-DE)",grandfathered="(?:"+irregular+"|"+regular+")",privateuse="(?:x(?:-[a-z0-9]{1,8})+)",singleton="(?:"+DIGIT+"|[A-WY-Za-wy-z])",extension="(?:"+singleton+"(?:-"+alphanum+"{2,8})+)",variant="(?:"+alphanum+"{5,8}|(?:"+DIGIT+alphanum+"{3}))",region="(?:"+ALPHA+"{2}|"+DIGIT+"{3})",script="(?:"+ALPHA+"{4})",extlang="(?:"+ALPHA+"{3}(?:-"+ALPHA+"{3}){0,2})",language="(?:"+ALPHA+"{2,3}(?:-"+extlang+")?|"+ALPHA+"{4}|"+ALPHA+"{5,8})",langtag=language+"(?:-"+script+")?(?:-"+region+")?(?:-"+variant+")*(?:-"+extension+")*(?:-"+privateuse+")?",languageTag="^(?:"+langtag+"|"+privateuse+"|"+grandfathered+")$";return new RegExp(languageTag,"i")}(),duplicateVariantRE=function(){var ALPHA="[a-zA-Z]",DIGIT="[0-9]",alphanum="(?:"+ALPHA+"|"+DIGIT+")",variant="(?:"+alphanum+"{5,8}|(?:"+DIGIT+alphanum+"{3}))",duplicateVariant="(?:"+alphanum+"{2,8}-)+("+variant+")-(?:"+alphanum+"{2,8}-)*\\1(?!"+alphanum+")";return new RegExp(duplicateVariant)}(),duplicateSingletonRE=function(){var ALPHA="[a-zA-Z]",DIGIT="[0-9]",alphanum="(?:"+ALPHA+"|"+DIGIT+")",singleton="(?:"+DIGIT+"|[A-WY-Za-wy-z])",duplicateSingleton="-("+singleton+")-(?:"+alphanum+"+-)*\\1(?!"+alphanum+")";return new RegExp(duplicateSingleton)}();exports.Intl={prioritizeLocales:PrioritizeLocales}}),window.L20n=require("l20n"),require("l20n/html")}(window);